---
knit: (function(inputFile, encoding) {rmarkdown::render(inputFile, encoding = encoding, output_dir = "../../content/labs")})
output:
  html_document:
    css: ../../_HeadersEtc/style.css
    highlight: default
    theme: paper
editor_options: 
  chunk_output_type: console
---

<script src="../../_HeadersEtc/hideOutput.js"></script>

<img src="../../_HeadersEtc/SESYNCBayes/Logo.png" style="position:absolute;top:20px;right:220px;width:150px;height=150px" />

##### `r readChar("../../_HeadersEtc/SESYNCBayes/Title.txt", file.info("../../_HeadersEtc/SESYNCBayes/Title.txt")$size)`

##### Writing Hierarchical Models Lab

##### `r format(Sys.Date(), format="%B %d, %Y")`

```{r preliminaries, include = FALSE}

library(knitr)

knitr::opts_chunk$set(cache = FALSE)

set.seed(10)

```

-----

### **Motivation**

The ability of Bayesian methods to handle hierarchical models in an unusually tidy way is why they are becoming the first choice for complex
problems in social and environmental science, problems with many unknowns, different type of data, and multiple sources of uncertainty. Recall that the posterior distribution of all of the unobserved quantities is proportionate to the joint distributions of the unobserved quantities and the data:

$$\big[\pmb{\theta}\mid\mathbf{y}\big]\propto\underbrace{\big[\pmb{\theta},\mathbf{y}\big]}_{{\text{Factor into sensible parts}}}$$

It follows that the starting point for developing hierarchical models is to write a properly factored expression for the proportionality between the posterior and joint distribution of the observed and unobserved quantities. Properly means that the expression for the factored joint distribution obeys the chain rule of probability after assumptions about independence have been made. Bayesian networks, also called
directed acyclic graphs (or, unattractively in my view, DAGs), offer a way to visually assure that your model does so. This will be true
if there is one unknown and one data set or one hundred unknowns and ten data sets. This factored expression is all that is required to
specify a "roll-your-own" MCMC algorithm or to write code in one of the current software packages that sample from the marginal
posterior distributions, JAGS, STAN, OpenBUGS etc. The expression for posterior and joint is where you start discussions with statistical
colleagues. It must be included in all papers and proposals using Bayesian methods because it communicates virtually everything about where your inferences come from.

Learning to write proper mathematical and statistical expressions for Bayesian models is 70 percent of the battle of learning how to
do Bayesian analysis. We will return to this battle time and time again during this course. In this exercise, we begin to learn the
vital skill of model building. The problems increase in difficulty as we proceed, so it will be important to understand what you did
right and wrong before you proceed to the next problem. In addition to practice drawing Bayesian networks and writing posterior and joint
distributions, the problems will challenge you to:

1. Choose distributions appropriate for the support of the random variable. 
2. Deftly use moment matching to convert means and standard deviations to parameters of distributions.

<br>

-----

### **Instructions**

For each problem below, draw the Bayesian network, write the posterior and joint distributions using generic bracket notation with appropriate products. Next, choose specific distributions following the general flow that we illustrated in the Light Limitation of Trees lecture. At this point, don't worry too much about the specific forms for prior distributions. We will learn more about composing these as the course proceeds. You may use uniform distributions with bounds that are vague for non-negative parameters. Use normal distributions centered on zero with large variances for real-valued parameters. Again, don't sweat this too much. 

Work in groups to allow discussion and to teach each other. Prepare a write up, one per group. You may use pencil and paper for drawing
DAGs and writing models. Please practice proper notation. Indicate vectors and matrices by underling their symbols.

We urge you to do a problem as completely as you possibly can, then consult the answer before going to the next problem. 

Good for you if you think you found a mistake! There will be some lurking errors because some of these problems have not been vetted.
There is no better way to show that you are learning than to find mistakes. 

Accumulate questions.

<br>

-----

### **Cover of invasives on transects**

This problem is taken with minor modification from work Tom is doing for the National Park Service Inventory and Monitoring Program. The
data consist of point intercepts taken at .1 m intervals along 30 meter transects. Each transect has 300 points where observers classify
a point defined by a plumb line dropped vertically from the transect as intersecting with exotic vegetation, native vegetation, or bare
ground. There are 100 transects. You seek to estimate the proportion of total vegetative cover that is native using the proportion of a
transect that is bare ground as a predictor variable. Develop a Bayesian model for this problem that properly models uncertainty in the predictor variable (proportion bare ground) and the response variable (proportion exotic cover). Hints - Think about two data models, one for the response and one for the predictor variable. Model the $x's$ using the same approach you use for modeling the $y's$ and link the data models via a latent, unobserved quantity. The sample unit is a transect. Start by thinking about what is observed, what is unobserved, and
what is known for each transect. 

Define:
1. $y_{i}=$ observed number of hits of exotics on transect $i$
2. $v_{i}=$ number of hits of exotic and native vegetation on transect
3. {$i$, }presumed to be known because it observed without error.
4. $x_{i}=$ the true, unobserved proportion of bare ground on transect *i*
5. $w_{i}=$ observed number of hits with bare soil
6. $n_{i}=$ total number of intercepts on a transect, known.
7. $N$ = total number of transects

<br>

<button class="button" onclick="toggle_visibility('myDIV1');">Answers</button>

<div id="myDIV1", style="display:none">

<br>


</div>

<br>

-----

### **Controls on willow seedling establishment**


